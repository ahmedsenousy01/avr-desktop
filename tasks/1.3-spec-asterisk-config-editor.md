## Implementation Spec — Asterisk Config Editor

Implementation Order: 3

### Overview

Edit essential PJSIP/network/dialplan settings and write Asterisk config files per deployment.

### Goals

- Simple form-based editing of core Asterisk settings.
- Generate files for container mounts.

### Functional Requirements

1. Use defaults from `src/main/infra/asterisk/conf`.
2. Editable fields: external/internal IPs, SIP port, RTP range, codecs (basic), DTMF mode, minimal dialplan.
3. Write `ari.conf`, `pjsip.conf`, `extensions.conf`, `manager.conf`, `queues.conf` to `[deployment]/asterisk/`.

### UI/UX

- Basic form; advanced options hidden by toggle.

### Data & Persistence

- Values stored in `deployment.json`; files emitted under `asterisk/` on save.

### IPC/Backend

- IPC to render and write config files.

### Validation

- Port ranges, IP formats, required sections present.

### Out of Scope

- Full dialplan visual editor (MVP).

### Open Questions

- Codec defaults; NAT specifics.

### Notes

- Implementation planning will use the Generate Task List rule in `rules/`.

### Data Model (deployment.json.asterisk)

```json
{
  "externalIp": "",
  "sipPort": 5060,
  "rtpStart": 10000,
  "rtpEnd": 20000,
  "codecs": ["opus", "ulaw"],
  "dtmfMode": "rfc4733",
  "pjsip": {}
}
```

### Template Engine

- Use simple tokenized templates for `*.conf` files with safe replacements.
- Source defaults from `src/main/infra/asterisk/conf`; write to `[deployment]/asterisk/`.

### IPC API

- `asterisk:render-config` (inputs: deployment `asterisk` block) → writes files
- `asterisk:validate-config` → returns issues/warnings

### Renderer Components

- `AsteriskEditor` form with Basic/Advanced sections; Save emits files.

### Acceptance Criteria

- Saving writes all five files with selected ports/IPs and basic dialplan.
- Validation catches bad IPs/port ranges and missing required stanzas.
- Compose mounts use these files read-only.

### Tasks Outline

- Define token set and scaffolding for each `*.conf` file.
- Implement render/validate IPC handlers.
- Build form UI with sensible defaults and help text.
