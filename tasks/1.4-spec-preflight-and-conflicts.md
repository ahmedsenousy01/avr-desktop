## Implementation Spec — Preflight & Conflicts

Implementation Order: 4

### Overview

Run environment and configuration checks before starting containers.

### Goals

- Catch port/name conflicts and missing prerequisites early.

### Functional Requirements

1. Verify Docker is installed and reachable.
2. Detect port usage conflicts and existing container/name collisions.
3. Validate provider keys exist for the chosen stack.
4. Optional: image pull check and size warnings.

### UI/UX

- Preflight panel with pass/warn/fail indicators and remediation tips.

### Data & Persistence

- Store last preflight results in deployment folder (JSON).

### IPC/Backend

- IPC to query docker, host ports, and generate report.

### Out of Scope

- Automatic port remapping (MVP).

### Open Questions

- Which ports to probe by provider defaults.

### Notes

- Implementation planning will use the Generate Task List rule in `rules/`.

### Checks

- Docker engine reachable (e.g., `docker version --format`).
- Host port availability for SIP and RTP ranges; app-assigned service ports.
- Container/name collisions using `${slug}` prefix.
- Required provider keys present in `providers.json` for selected providers.

### IPC API

- `preflight:run` → returns structured results (pass/warn/fail items)
- `preflight:last` → returns last results for this deployment

### Renderer Components

- `PreflightPanel` showing grouped checks with remediation links.

### Acceptance Criteria

- Running preflight surfaces conflicts before enabling Start.
- Results are stored and shown on subsequent visits until config changes.

### Tasks Outline

- Implement checks for ports, docker, names, and provider keys.
- Persist last results next to `deployment.json`.
