## Implementation Spec — Compose Generation & Control

Implementation Order: 5

### Overview

Generate `docker-compose.yml` per deployment from JSON selections, run up/down, and maintain status.

### Goals

- Deterministic compose generation.
- First-class runtime controls in-app.

### Functional Requirements

1. Generate compose from `deployment.json` + provider settings.
2. Use deployment slug as prefix for container/resource names.
3. `docker compose up -d` and `docker compose down` from GUI.
4. Track status via `docker ps/inspect` and healthchecks.

### UI/UX

- Start/Stop buttons; status badges per service.

### Data & Persistence

- Emit `docker-compose.yml` in deployment folder.

### IPC/Backend

- IPC to run docker commands and stream output.

### Validation

- Ensure required env/config mounts present.

### Out of Scope

- Kubernetes orchestration.

### Open Questions

- Standardize healthchecks for services lacking them.

### Notes

- Implementation planning will use the Generate Task List rule in `rules/`.

### Generation Details

- Compose version `3.9`.
- Service naming: `${slug}-asterisk`, `${slug}-asr-*`, `${slug}-llm-*`, `${slug}-tts-*`, `${slug}-sts-*`.
- Inject provider env from `providers.json` at generation time (no `.env`).
- Mount `[deployment]/asterisk` as read-only into Asterisk container.

### IPC API

- `compose:generate` → writes `docker-compose.yml`
- `compose:up` → runs `docker compose up -d` (returns per-service start results)
- `compose:down` → runs `docker compose down`
- `compose:status` → summarizes `docker ps/inspect` for services
- `compose:logs` → stream logs per service

### Renderer Components

- `DeploymentRunPanel` with Start/Stop and service status list.

### Acceptance Criteria

- Generated file is deterministic for same inputs and includes mounts/env/ports.
- Up/Down commands surface success/failure with actionable messages.
- Status reflects running/healthy states within a few seconds.

### Tasks Outline

- Implement provider-to-service mapping and env injection.
- Build compose writer with container name prefixing.
- Implement run/status/logs IPC with robust process handling.
